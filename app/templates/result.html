<!doctype html>
<html lang="ja">
<html>
  <head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<title>Financial Eye 360 - {{title}}</title>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-primary mb-2">
	  <a href="/index" class="navbar-brand">
        <img src="../static/eye.png" width="30" height="30" alt="">
        Financial Eye 360
      </a>
	  <form action="/search" method="GET" class="form-inline">
        <div class="input-group">
        <input type="text" class="form-control" name="code" id="text5a" placeholder="銘柄コード">
        <div class="input-group-append">
          <button type="submit" class="btn btn-secondary">検索</button>
        </div>
        </div>
      </form>
    </nav>

	 <div class="container">
    {% for edinetcodeinfo in all_edinetcodeinfo %}
		<table class="table">
		<tr>
			<th style="width:20%">会社名 (銘柄コード)</th>
			<td style="width:80%">{{edinetcodeinfo.submitter}} 【{{edinetcodeinfo.securitiescode}}】</td>
		</tr>
		<tr>
			<th style="width:20%">業種</th>
			<td style="width:80%">{{edinetcodeinfo.businesstype}}</td>
		</tr>
		<tr>
			<th style="width:20%">URL(IR)</th>
			<td style="width:80%"></td>
		</tr>
		<tr>
			<th style="width:20%">決算月</th>
			<td style="width:80%">{{edinetcodeinfo.fiscalperiod}}</td>
		</tr>
		<tr>
			<th style="width:20%">特色</th>
			<td style="width:80%">-</td>
		</tr>
		</table>
	{% endfor %}

	<ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" id="item11-tab" data-toggle="tab" href="#item11" aria-controls="item11" aria-selected="true">業績</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="item22-tab" data-toggle="tab" href="#item22" aria-controls="item22" aria-selected="false">株価</a>
      </li>
    </ul>
 	
	<div class="tab-content">
    <div class="tab-pane fade show active" id="item11" aria-labelledby="item11-tab">
	
    <div class="row">
      <div class="col-md-6">
        <canvas id="saleschart" width="600" height="400"></canvas>
      </div>
	  <div class="col-md-6">
        <canvas id="cashchart" width="600" height="400"></canvas>
      </div>
	</div>
 
	<div class="row">
	  <div class="col-md-12">
        <table class="table">
		<thead class="thead-light">
		 <th class="fixed-column-0">P/L</th>
		 {% for financeinfo in all_financeinfo %}
             <th>{{financeinfo.enddate}}</th>
         {% endfor %}
		</thead>
		<tbody>
		<tr>
			<th>売上高</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.netsales}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>売上原価</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.costofsales}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>売上総利益</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.grossprofit}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>販管費</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.sellinggeneral}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>営業利益</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.operatingincome}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>営業外収益</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.nonoperatingincome}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>営業外費用</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.nonoperatingexpenses}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>経常利益</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.ordinaryincome}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>特別利益</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.extraordinaryincome}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>特別損失</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.extraordinaryloss}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>税引前当期純利益</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.incomebeforeincometaxes}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>法人税等</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.incometaxes}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>当期純利益</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.profitloss}}</td>
			{% endfor %}
		</tr>
		</tbody>
		</table>
      </div>
	  </div>

	<div class="row">
	  <div class="col-md-12">
        <table class="table">
		<thead class="thead-light">
		 <th class="fixed-column-0">B/S</th>
		 {% for financeinfo in all_financeinfo %}
             <th>{{financeinfo.enddate}}</th>
         {% endfor %}
		</thead>
		<tbody>
		<tr>
			<th>流動資産</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.currentassets}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>固定資産</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.noncurrentassets}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>有形固定資産</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.propertyplantandequipment}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>無形固定資産</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.intangibleassets}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>投資その他の資産</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.investmentsAndotherAssets}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>流動負債</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.currentliabilities}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>固定負債</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.noncurrentliabilities}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>純資産</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.netAssets}}</td>
			{% endfor %}
		</tr>
		</tbody>
		</table>
      </div>
	</div>

	<div class="row">
	  <div class="col-md-12">
        <table class="table">
		<thead class="thead-light">
		 <th class="fixed-column-0">C/S</th>
		 {% for financeinfo in all_financeinfo %}
             <th>{{financeinfo.enddate}}</th>
         {% endfor %}
		</thead>
		<tbody>
		<tr>
			<th>営業活動によるキャッシュ・フロー</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.scf}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>投資活動によるキャッシュ・フロー</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.icf}}</td>
			{% endfor %}
		</tr>
		<tr>
			<th>財務活動によるキャッシュ・フロー</th>
			{% for financeinfo in all_financeinfo %}
			<td>{{financeinfo.fcf}}</td>
			{% endfor %}
		</tr>
		</tbody>
		</table>
      </div>
	</div>
	
	</div>
	
	<div class="tab-pane fade" id="item22" aria-labelledby="item22-tab">
    <div class="row">
	  <div class="col-md-12">
        <div id="chart">
		<div id="candlestick"></div>
		</div>
	  </div>
	  <div class="col-md-12">
        <div id="chart">
		<div id="volume"></div>
		</div>
	  </div>
	  <div class="col-md-12">
        <div id="chart">
		<div id="filter"></div>
		</div>
	  </div>
    </div>
    </div>

	</div>
</div> <!-- for container -->

<script>
var barData = {
  labels : [{% for financeinfo in all_financeinfo %}
            "{{financeinfo.enddate}}",
        {% endfor %}],
  datasets : [
  {
    type: 'line',
    label: '粗利率',
    borderColor : "rgba(254,97,132,0.8)",
    pointBackgroundColor    : "rgba(254,97,132,0.8)",
	fill: false,
	yAxisID: "y-axis-2",
    data : [{% for financeinfo in all_financeinfo %}
			{%if financeinfo.grossprofit != '-' %}
                  ({{financeinfo.grossprofit}} / {{financeinfo.netsales}}) * 100,
			{% else %}
				,
			{% endif %}
           {% endfor %}]
  },
  {
    type: 'line',
    label: '営業利益率',
    borderColor : "rgba(96,250,126,0.8)",
    pointBackgroundColor    : "rgba(96,250,126,0.8)",
	fill: false,
	yAxisID: "y-axis-2",
    data : [{% for financeinfo in all_financeinfo %}
			{%if financeinfo.operatingincome != '-' %}
                  ({{financeinfo.operatingincome}} / {{financeinfo.netsales}}) * 100,
			{% else %}
				,
			{% endif %}
           {% endfor %}]
  },
  {
    type: 'line',
    label: '経常利益率',
    borderColor : "rgba(255,252,141,0.8)",
    pointBackgroundColor    : "rgba(255,252,141,0.8)",
	fill: false,
	yAxisID: "y-axis-2",
    data : [{% for financeinfo in all_financeinfo %}
			{%if financeinfo.ordinaryincome != '-' %}
                  ({{financeinfo.ordinaryincome}} / {{financeinfo.netsales}}) * 100,
			{% else %}
				,
			{% endif %}
           {% endfor %}]
  },
  {
    type: 'line',
    label: '当期純利益率',
    borderColor : "rgba(218,181,255,0.8)",
    pointBackgroundColor    : "rgba(218,181,255,0.8)",
	fill: false,
	yAxisID: "y-axis-2",
    data : [{% for financeinfo in all_financeinfo %}
			{%if financeinfo.profitloss != '-' %}
                  ({{financeinfo.profitloss}} / {{financeinfo.netsales}}) * 100,
			{% else %}
				,
			{% endif %}
           {% endfor %}]
  },
  {
    type: 'bar',
    label: '売上高(百万円)',
    borderColor : "rgba(54,164,235,0.8)",
    backgroundColor : "rgba(54,164,235,0.5)",
    borderWidth:5,
	yAxisID: "y-axis-1",
    data : [{% for financeinfo in all_financeinfo %}
			{%if financeinfo.netsales != '-' %}
                  {{financeinfo.netsales}},
			{% else %}
				,
			{% endif %}
           {% endfor %}]
  }
  ]
}
var saleschart = document.getElementById("saleschart");
var schart = new Chart(saleschart, {
  type:'bar',
  data:barData,
  options: {
      responsive: true,
      title: {
        display: true,
        text: '通期業績推移'
      },
	  scales: {
        yAxes: [{
		  id: "y-axis-1",
		  type: "linear",
		  position: "left",
          ticks: {
            //suggestedMax: Math.max(values) / 1000000,
            suggestedMin: 0,
            //stepSize: 10,
            callback: function(value, index, values){
              return  value
            }
          }
        },
		{
		  id: "y-axis-2",
		  type: "linear",
		  position: "right",
          ticks: {
            //suggestedMax: Math.max(values) / 1000000,
            suggestedMin: 0,
            //stepSize: 10,
            callback: function(value, index, values){
              return  value + '%'
            }
          },
		  gridLines: {
			drawOnChartArea: false, 
          }
        }
		]
      }
  }
});

var CashData = {
  labels : [{% for financeinfo in all_financeinfo %}
            "{{financeinfo.enddate}}",
        {% endfor %}],
  datasets : [
  {
    type: 'bar',
    label: '営業CF(百万円)',
    borderColor : "rgba(254,97,132,0.8)",
    backgroundColor : "rgba(254,97,132,0.5)",
    borderWidth:5,
    data : [{% for financeinfo in all_financeinfo %}
			{%if financeinfo.scf != '-' %}
                  {{financeinfo.scf}},
			{% else %}
				,
			{% endif %}
           {% endfor %}]
  },
  {
    type: 'bar',
    label: '投資CF(百万円)',
    borderColor : "rgba(54,164,235,0.8)",
    backgroundColor : "rgba(54,164,235,0.5)",
    borderWidth:5,
    data : [{% for financeinfo in all_financeinfo %}
			{%if financeinfo.icf != '-' %}
                  {{financeinfo.icf}},
			{% else %}
				,
			{% endif %}
           {% endfor %}]
  },
  {
    type: 'bar',
    label: '財務CF(百万円)',
    borderColor : "rgba(96,250,126,0.8)",
    backgroundColor : "rgba(96,250,126,0.5)",
    borderWidth:5,
    data : [{% for financeinfo in all_financeinfo %}
			{%if financeinfo.fcf != '-' %}
                  {{financeinfo.fcf}},
			{% else %}
				,
			{% endif %}
           {% endfor %}]
  }
  ]
}

var cashchart = document.getElementById("cashchart");
var cchart = new Chart(cashchart, {
  type:'bar',
  data:CashData,
  options: {
      responsive: true,
      title: {
        display: true,
        text: 'キャッシュフロー推移'
      },
	  scales: {
        yAxes: [{
          ticks: {
            //suggestedMax: Math.max(values) / 1000000,
            suggestedMin: 0,
            //stepSize: 10,
            callback: function(value, index, values){
              return  value
            }
          }
        }
		]
      }
  }
});
</script>

<script type="text/javascript">
google.charts.load('current', {'packages':['corechart', 'controls']});
var chart_div = document.getElementById('chart');

function drawChart() {
   var data = new google.visualization.DataTable();
   data.addColumn('datetime', 'Date');
   data.addColumn('number', 'Open');
   data.addColumn('number', 'High');
   data.addColumn('number', 'Low');
   data.addColumn('number', 'Close');
   data.addColumn('number', 'Volume');
   let d=JSON.parse('{{all_stocks|tojson}}');
   d.forEach(function (di) {
           data.addRow([{ v: new Date(di.date), f: di.date }, di.open, 
                          di.high, di.low, di.close, di.volume]);
   });
	
   var dashboard = new google.visualization.Dashboard(chart_div);
   var control = new google.visualization.ControlWrapper({
       controlType: 'ChartRangeFilter',
       containerId: 'filter',
       options: {
           filterColumnIndex: 0,
           ui: {
               chartType: 'LineChart',
               chartOptions: {
                   chartArea: {
                       height: '80%', width: '100%', 
                       backgroundColor: { stroke: "gray", strokeWidth: 1 }
                   },
                   hAxis: { baselineColor: 'none' }
               },
               chartView: { columns: [0, 4] },
           }
       }
   });

   var chart = new google.visualization.ChartWrapper({
       chartType: 'CandlestickChart',
       containerId: 'candlestick',
       options: {
           chartArea: { height: '80%', width: '100%',  
                        backgroundColor: { stroke: "gray", strokeWidth: 1 } },
           hAxis: { type: 'category', slantedText: false, maxTextLines: 1, 
                    maxAlternation: 1 },
           legend: { position: 'none' },
           candlestick: {
               fallingColor: { strokeWidth: 0, fill: '#a52714' },
               risingColor: { strokeWidth: 0, fill: '#0f9d58' }
           },
           title: "株価:"
       },
       view: { columns: [0, 3, 1, 4, 2] }
   });

   var volume = new google.visualization.ChartWrapper({
       chartType: 'ColumnChart',
       containerId: 'volume',
       options: {
           chartArea: { height: '80%', width: '100%', top: 40, bottom: 30, 
                        backgroundColor: { stroke: "gray", strokeWidth: 1 } },
           hAxis: { type: 'category', slantedText: false, maxTextLines: 1, 
                    maxAlternation: 1 },
           legend: { position: 'none' },
           title: "出来高:"
       },
       view: { columns: [0, 5] }
   });

   dashboard.bind(control, [chart, volume]);
   dashboard.draw(data);
}
google.charts.setOnLoadCallback(drawChart);
</script>

	<script src="https://riversun.github.io/chatux/chatux.min.js"></script>
	<script>
		const chatux = new ChatUx();
	
		//ChatUXの初期化パラメータ
	const initParam =
			{
				renderMode: 'auto',
				api: {
					//echo chat server
					endpoint: 'https://script.google.com/macros/s/AKfycbzro2SWVx5lMKfbLu4cBt16xbqg4lT7xU5wfu4bbSQs-OMcFsQh/exec',
					method: 'GET',
					dataType: 'jsonp'
				},
				bot: {
					botPhoto: 'https://riversun.github.io/chatbot/bot_icon_operator.png',
					humanPhoto: null,
					widget: {
						sendLabel: '送信',
						placeHolder: '分からない単語を入力してみてください'
					}
				},
				window: {
					title: '株bot',
					infoUrl: 'https://github.com/riversun/chatux'
				}
			};
		chatux.init(initParam);
		chatux.start(false);
	</script>
	
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
  </body>
</html>