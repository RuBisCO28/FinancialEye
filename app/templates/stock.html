<!doctype html>
<html lang="ja">
<html>
  <head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/bsadmin.css">
	<link rel="shortcut icon" href="../static/favicon.ico">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<title>Financial Eye 360 - {{code}}</title>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-primary">
	  <a href="/index" class="navbar-brand">
       <img src="../static/eye.png" width="30" height="30" class="d-inline-block align-top" alt="">
        Financial Eye 360
      </a>
	  <form action="/search" method="GET" class="form-inline">
        <div class="input-group">
        <input type="text" class="form-control" name="code" id="text5a" placeholder="銘柄コード">
        <div class="input-group-append">
          <button type="submit" class="btn btn-secondary">検索</button>
        </div>
        </div>
      </form>
    </nav>
	
	<div class="d-flex align-items-stretch">
    <div class="sidebar bg-dark">
        <ul class="list-unstyled">
            <li><a href="/company/{{code}}">業績データ(通期)</a></li>
            <li><a href="#">株価データ</a></li>
            <li><a href="/gtrend/{{code}}">Googleトレンド</a></li>
        </ul>
    </div>

	 <div class="container-fluid">
    {% for edinetcodeinfo in all_edinetcodeinfo %}
		<table class="table">
		<tr>
			<th style="width:20%">会社名 (銘柄コード)</th>
			<td style="width:80%">{{edinetcodeinfo.submitter}} 【{{edinetcodeinfo.securitiescode}}】</td>
		</tr>
		<tr>
			<th style="width:20%">業種</th>
			<td style="width:80%">{{edinetcodeinfo.businesstype}}</td>
		</tr>
		<tr>
			<th style="width:20%">URL(IR)</th>
			<td style="width:80%"></td>
		</tr>
		<tr>
			<th style="width:20%">決算月</th>
			<td style="width:80%">{{edinetcodeinfo.fiscalperiod}}</td>
		</tr>
		<tr>
			<th style="width:20%">特色</th>
			<td style="width:80%">-</td>
		</tr>
		</table>
	{% endfor %}
	
    <div class="row">
	  <div class="col-md-12">
        <div id="chart">
		<div id="candlestick"></div>
		</div>
	  </div>
	  <div class="col-md-12">
        <div id="chart">
		<div id="volume"></div>
		</div>
	  </div>
	  <div class="col-md-12">
        <div id="chart">
		<div id="filter"></div>
		</div>
	  </div>
    </div>

</div> <!-- container -->
</div> <!-- sidebar -->

<script type="text/javascript">
google.charts.load('current', {'packages':['corechart', 'controls']});
var chart_div = document.getElementById('chart');

function drawChart() {
   var data = new google.visualization.DataTable();
   data.addColumn('datetime', 'Date');
   data.addColumn('number', 'Open');
   data.addColumn('number', 'High');
   data.addColumn('number', 'Low');
   data.addColumn('number', 'Close');
   data.addColumn('number', 'Volume');
   let d=JSON.parse('{{all_stocks|tojson}}');
   d.forEach(function (di) {
           data.addRow([{ v: new Date(di.date), f: di.date }, di.open, 
                          di.high, di.low, di.close, di.volume]);
   });
	
   var dashboard = new google.visualization.Dashboard(chart_div);
   var control = new google.visualization.ControlWrapper({
       controlType: 'ChartRangeFilter',
       containerId: 'filter',
       options: {
           filterColumnIndex: 0,
           ui: {
               chartType: 'LineChart',
               chartOptions: {
                   chartArea: {
                       height: '80%', width: '100%', 
                       backgroundColor: { stroke: "gray", strokeWidth: 1 }
                   },
                   hAxis: { baselineColor: 'none' }
               },
               chartView: { columns: [0, 4] }
           }
       }
   });

   var chart = new google.visualization.ChartWrapper({
       chartType: 'CandlestickChart',
       containerId: 'candlestick',
       options: {
           chartArea: { height: '80%', width: '100%',  
                        backgroundColor: { stroke: "gray", strokeWidth: 1 } },
           hAxis: { type: 'category', slantedText: false, maxTextLines: 1, 
                    maxAlternation: 1 },
           legend: { position: 'none' },
           candlestick: {
               fallingColor: { strokeWidth: 0, fill: '#a52714' },
               risingColor: { strokeWidth: 0, fill: '#0f9d58' }
           },
           title: "株価:"
       },
       view: { columns: [0, 3, 1, 4, 2] }
   });

   var volume = new google.visualization.ChartWrapper({
       chartType: 'ColumnChart',
       containerId: 'volume',
       options: {
           chartArea: { height: '80%', width: '100%', top: 40, bottom: 30, 
                        backgroundColor: { stroke: "gray", strokeWidth: 1 } },
           hAxis: { type: 'category', slantedText: false, maxTextLines: 1, 
                    maxAlternation: 1 },
           legend: { position: 'none' },
           title: "出来高:"
       },
       view: { columns: [0, 5] }
   });

   dashboard.bind(control, [chart, volume]);
   dashboard.draw(data);
}
google.charts.setOnLoadCallback(drawChart);
</script>

	<script src="https://riversun.github.io/chatux/chatux.min.js"></script>
	<script>
		const chatux = new ChatUx();
	
		//ChatUXの初期化パラメータ
	const initParam =
			{
				renderMode: 'auto',
				api: {
					//echo chat server
					endpoint: 'https://script.google.com/macros/s/AKfycbzro2SWVx5lMKfbLu4cBt16xbqg4lT7xU5wfu4bbSQs-OMcFsQh/exec',
					method: 'GET',
					dataType: 'jsonp'
				},
				bot: {
					botPhoto: 'https://riversun.github.io/chatbot/bot_icon_operator.png',
					humanPhoto: null,
					widget: {
						sendLabel: '送信',
						placeHolder: '分からない単語を入力してみてください'
					}
				},
				window: {
					title: '株bot',
					infoUrl: 'https://github.com/riversun/chatux'
				}
			};
		chatux.init(initParam);
		chatux.start(false);
	</script>
	
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
	<script src="../static/js/bsadmin.js"></script>
  </body>
</html>